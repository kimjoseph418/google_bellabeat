---
title: "Bellabeat Case Study"
author: "Joseph Kim"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include = FALSE}
library(tidyverse)
library(tidyr)
library(dplyr)
library(lubridate)
library(ggplot2)
library(janitor)
library(ggpubr)
library(chron)

daily_activity <- read.csv('dailyActivity_merged.csv')
heartrate_seconds <- read.csv('heartrate_seconds_merged.csv')
sleep_day <- read.csv('sleepDay_merged.csv')
weight_log_info <- read.csv('weightLogInfo_merged.csv')
hourly_calories <- read.csv('hourlyCalories_merged.csv')
```

## Data validation

```{r validate}
head(daily_activity)
head(heartrate_seconds)
head(sleep_day)
head(weight_log_info)
head(hourly_calories)


head(daily_activity)
head(heartrate_seconds)
head(sleep_day)
head(weight_log_info)
head(hourly_calories)
```
Things to note: *weightLogInfo_merged* dataset only had 8 out of 33 total users recorded, which is a low representation of the users recorded in the *dailyActivity_merged* dataset (about 24% of population). This may give a result that does not enough power and potentially result in a Type II error.
    
I also noticed that some date columns were in character format, and therefore converted to date format using the **lubridate** package.

```{r lubridate}
daily_activity$ActivityDate <- mdy(daily_activity$ActivityDate, format = NULL)
heartrate_seconds$Time <- mdy_hms(heartrate_seconds$Time, format = NULL)
sleep_day$SleepDay <- mdy_hms(sleep_day$SleepDay, format = NULL)

str(daily_activity)
str(heartrate_seconds)
str(sleep_day)
```

## Data preparation

```{r prepare}
# Renaming columns
daily_activity <- daily_activity %>%
    clean_names() %>%
    rename_with(tolower) %>%
    rename(date = activity_date)

heartrate_seconds <- heartrate_seconds %>%
    clean_names() %>%
    rename_with(tolower)

sleep_day <- sleep_day %>%
    clean_names() %>%
    rename_with(tolower) %>%
    rename(date = sleep_day)

hourly_calories <- hourly_calories %>%
    clean_names() %>%
    rename_with(tolower) %>%
    rename(date_time = activity_hour)

# Getting statistical summaries of each table
summary(daily_activity)
summary(heartrate_seconds)
summary(sleep_day)
summary(hourly_calories)

# Removing duplicates and N/A
daily_activity <- daily_activity %>%
    distinct() %>%
    drop_na()

heartrate_seconds <- heartrate_seconds %>%
    distinct() %>%
    drop_na()

sleep_day <- sleep_day %>%
    distinct() %>%
    drop_na()
```

## Merging data

```{r merge}
merged_activity_sleep <- merge(daily_activity, sleep_day, by = c('id', 'date'))
head(merged_activity_sleep)
```

## Visualizations

```{r visuals, echo = FALSE}
ggplot(data = merged_activity_sleep, mapping = aes(x = calories, y = total_minutes_asleep)) +
    geom_point() +
    geom_smooth()
```

We can see from above that there is not much correlation between calories burnt and sleep quality. We will need to explore other relationships that can suggest new business ideas.